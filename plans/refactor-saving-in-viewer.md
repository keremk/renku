# Current Problems
I have identified some inconsistency and UX problems in the Viewer Panels (Input, Outputs, Models) for the editing and saving experiences:

- In Inputs panel, there is a top level Save Changes/Undo drop down button to the left of RUN button. But there is also a Save button in the Text Edit dialog and it looks like it is saved, but it only gets saved if I hit Save changes. This is a very confusing UX.  
- In Models panel, saves are immediately applied when I hit Save in the Text Panel dialog, but if I change a value in the other types of field, the Save Changes button pops up. Inconsistent both within the panel and also inconsistent with the Inputs Panel behaviours
- In Outputs panel, the cards show an "Edited" label and a restore original dropdown, the edited means it is already saved - I guess. 
- The Save Changes button in the tab bar persists across different tabs Inputs, Models, Outputs but only applies to whichever tab actually popped it up and in Outputs panel it does not apply at all. This is very confusing UX.
- In some cards, we show drop-down options that don't make any sense: Text Artifact (Open in new tab, download, copy URL does not make sense), Media Artifact (Copy URL does not make any sense)

# Proposed New UX
I want to overhaul the overall editing/saving experience and make it easy to understand and consistent across all tabs.

## Save UX
- We will remove the top level Save/Undo button from the UI. 

### Input and Models Panels
- These panels allow the users to create and configure inputs to the pipeline. 
- The input field values, model selection and configurations are saved into input.yaml file per build folder. If the inputs.yaml does not exist in a build folder, they are copied from the input-template.yaml file in the blueprint folder. 
  - Models tab also allows editing the prompts used by prompt producers. The original prompts are stored inside a folder under the blueprint folder. This prompt producer configuration folder contains prompt TOML files as well as the YAML and JSON schemas. The users cannot edit the YAML or JSON schemas for the producers but they can tweak the prompts. So when they are changed, the edited prompts are saved under builds/{movie-id}/prompts/{prompt-filename}.toml (Current behavior, we will keep).
- There should be no undo changes options, we should remove the undo changes. 
- The Text Card, opens up an Edit dialog with a code editor using Markdown Syntax highlighting (which is a superset of text). The editor supports select/copy/paste and undo/redo via regular keybindings. When the editing is done, the user hits Save and the contents are saved into the right location.  
- The Media Cards, allow drag&drop or file dialog selection of media files (audio, video, image etc.) and these are saved into the builds/{movie-id}/input-files folder with proper links. Currently this is how it is working and should be unchanged.
- The short text and other types of inputs (like drop-downs etc.) are all saved directly without needing an explicit save button (auto-save with debounce, i.e. not every key stroke)
- In the models panel, the Collapsible Section for prompt producers has an "edited" label at the top-right corner. This is unnecessary and should be removed.
- In the models panel, we have a complex property editor (for subtitles) which is displayed as a card and also pops up a dialog to edit the properties. Because this pops up a dialog with a Save button, we should not use Auto-save in this case, and rely on Save button to explicitly save the changed values.

### Outputs Panel
- This panel show the content generated by producers. Since each generation costs money, we want to make sure we don't accidentally delete these.
- There are 2 options:
  - Users can ask for regenaration of specific outputs or all outputs of a particular producer. When a user runs the build again these will be marked dirty and regenerated. The UI state changes after a successful run/re-generation back to "Not marked for generation". 
    - Specific ones are marked in the drop-down of the Text and Media Cards. And the card border color changes to indicate a visual cue. This is the current behavior unchanged.  
    - User can select all the outputs of a producer to be regenerated and that is by the check-box on top-right of the collapsible panel. Again this is the current behavior, unchanged.
  - Users can edit the content generated manually. This will then be fed into the downstream producers who depend on this edited content for regeneration. When a user runs the build again the downstream producers will have dirty inputs and will re-generate their outputs. 
    - Text: This pops up the same code editor dialog (from the Inputs/Models text cards) using the same UI and capabilities. When a user saves the content, the content is saved with a different hash (current behavior). The card footer has a "User Edited" label as a visual indicator. Users can rollback this edit to the generated version from the drop-down when this state is set. (current behavior)
    - Media: This pops up the same upload/drag&drop UI (as in Inputs). The content uploaded is created with a new hash and its own folder. (Current behavior) The card footer has a "User Edited" label as a visual indicator. Users can rollback this edit to the generated version from the drop-down when this state is set. (current behavior)
    
## Text & Media Cards
- All text and media cards across all panels should re-use the same codebase, with options for appropriate behavior per role when needed as explained in the above sections in the Save UX.
- Code Editor dialog for Text cards should have the same codebase with options for appropriate behavior.
- The "Edited" label (for Outputs Panel cards only) stays the same.
- The drop-down menus should be consistent and appropriate for use. See the below:

### Text Cards
#### Inputs Panel
- The hover-over expand, expands and shows the code editor dialog in read-only mode and with only "Close" button.
- There is no drop-down menu in the footer, instead a button labeled "Edit". Styled as a button but smaller than the RUN button. Clicking this button opens up the code editor dialog in read/write mode with Cancel and Save buttons.

#### Models Panel (Prompt Producers)
- The hover-over expand, expands and shows the code editor dialog in read-only mode and with only "Close" button.
- There is no drop-down menu in the footer, instead a button labeled "Edit". Styled as a button but smaller than the RUN button. Clicking this button opens up the code editor dialog in read/write mode with Cancel and Save buttons.

#### Outputs Panel
- The hover-over expand, expands and shows the code editor dialog in read-only mode and with only "Close" button.
- The drop-down only shows Edit and Generate Again, remove the other options (Expand, Download, Open in New Tab and Copy URL). 
  - Clicking Edit opens up the code editor dialog in read/write mode with Cancel and Save buttons.
- The drop-down also shows "Restore Original" (as before) when the card is edited. 

### Media Cards
#### Inputs Panel
- Same behavior as it is now. No changes. Make sure no regressions in the way they are laid out and organized under the the collapsible sections. 

#### Models Panel
- Currently there is no config property that is not mapped from Input, so we don't have use for Media cards yet. 

#### Outputs Panel
- The hover-over expand is the same behavior, changes. Make sure no regressions in the way they are laid out and organized under the the collapsible sections.
- The drop-down only shows Edit, Generate Again, Download, Open In New Tab options. Remove the Copy URL (not relevant for local app) and Expand (redundant) options.
  - Clicking Edit opens up the media upload dialog as before no changes.
- The drop-down also shows "Restore Original" (as before) when the card is edited. 

### Complex Property Cards
- We created one complex property card so far, which is for Subtitles in the models panel (for the VideoExporter producer). 
- The only change required here is to ensure it has the same "Edit" button and re-use the same Card as the other cards. The contents are custom developed of course, but the footer should use the same codebase. 



The ArtifactTextCard in outputs panel is intentionally different from the shared TextCard:
  ┌────────────────┬───────────────────┬────────────────────────────────────────────────────────────┐
  │    Feature     │  Shared TextCard  │                      ArtifactTextCard                      │
  ├────────────────┼───────────────────┼────────────────────────────────────────────────────────────┤
  │ Content source │ value prop        │ Fetches from blob URL                                      │
  ├────────────────┼───────────────────┼────────────────────────────────────────────────────────────┤
  │ Save mechanism │ onChange callback │ editArtifactText API call                                  │
  ├────────────────┼───────────────────┼────────────────────────────────────────────────────────────┤
  │ Loading state  │ N/A               │ Yes (fetches content)                                      │
  ├────────────────┼───────────────────┼────────────────────────────────────────────────────────────┤
  │ Saving state   │ N/A               │ Yes (API call)                                             │
  ├────────────────┼───────────────────┼────────────────────────────────────────────────────────────┤
  │ Restore        │ N/A               │ Yes (restores original artifact)                           │
  ├────────────────┼───────────────────┼────────────────────────────────────────────────────────────┤
  │ Footer         │ CardActionsFooter │ ArtifactCardFooter with Download, Copy URL, Generate Again │
  └────────────────┴───────────────────┴────────────────────────────────────────────────────────────┘
  These are fundamentally different use cases:
  - Inputs/Models: Values in memory, saved via parent callback
  - Outputs: Artifacts stored as blobs on server, needs fetch/save/restore APIs

  The rename makes it clear they're different components. Should I try to extract more shared code between them,
   or is this separation acceptable given their different responsibilities?