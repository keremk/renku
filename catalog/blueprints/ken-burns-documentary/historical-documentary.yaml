meta:
  name: Historical Ken Burns Documentary
  description: A Ken Burns-style documentary blueprint optimized for historical narratives. Features narrated image segments with conditional text overlays for dates, locations, and historical figures, plus conditional map images for geographic context. Includes background music, transcription, and karaoke subtitles.
  id: HistoricalDocumentary
  kind: blueprint
  version: 0.1.0
  author: Renku
  license: MIT

inputs:
  - name: InquiryPrompt
    description: The historical topic or narrative to explore (e.g., "The fall of the Roman Empire", "The Silk Road trade routes").
    type: string
    required: true
  - name: NumOfImagesPerSegment
    description: Number of images to generate per narrative segment.
    type: int
    required: false
  - name: Style
    description: Visual style for image generation (e.g., "Oil painting, Renaissance style", "Photorealistic historical recreation").
    type: string
    required: true
  - name: Size
    description: Image resolution (1K, 2K, 4K, or custom).
    type: string
    required: false
  - name: AspectRatio
    description: Aspect ratio (16:9, 9:16, 1:1, 4:3, etc.).
    type: string
    required: false
  - name: Audience
    description: Target audience (e.g., adults, students, history enthusiasts).
    type: string
    required: false
  - name: VoiceId
    description: Voice identifier for narration audio generation.
    type: string
    required: true
  - name: Emotion
    description: Emotional tone for the narrator (e.g., neutral, somber, authoritative).
    type: string
    required: false
  - name: Language
    description: Narration language (e.g., en, es, fr).
    type: string
    required: false

artifacts:
  - name: SegmentImage
    description: Ken Burns style images per segment.
    type: multiDimArray
    itemType: image
  - name: SegmentAudio
    description: Narration audio per segment.
    type: array
    itemType: audio
  - name: Music
    description: Background music for the documentary.
    type: audio
  - name: Timeline
    description: Composed timeline JSON manifest.
    type: json
  - name: FinalVideo
    description: Final rendered MP4 with karaoke subtitles.
    type: video

loops:
  - name: segment
    description: Iterates over narrative segments.
    countInput: NumOfSegments
  - name: image
    description: Iterates over images per segment.
    parent: segment
    countInput: NumOfImagesPerSegment

conditions:
  hasTextOverlay:
    when: HistoricalScriptProducer.VideoScript.Segments[segment].HasTextOverlay
    is: true

producers:
  - name: HistoricalScriptProducer
    path: ./historical-script/historical-script.yaml
  - name: ImageProducer
    producer: image/text-to-image
    loop: segment.image
  - name: AudioProducer
    producer: audio/text-to-speech
    loop: segment
  - name: MusicProducer
    producer: audio/text-to-music
  - name: TimelineComposer
    producer: composition/timeline-composer
  - name: TranscriptionProducer
    producer: json/transcription
  - name: VideoExporter
    producer: composition/video-exporter

connections:
  # --- Wire inputs to HistoricalScriptProducer ---
  - from: InquiryPrompt
    to: HistoricalScriptProducer.InquiryPrompt
  - from: Duration
    to: HistoricalScriptProducer.Duration
  - from: NumOfSegments
    to: HistoricalScriptProducer.NumOfSegments
  - from: NumOfImagesPerSegment
    to: HistoricalScriptProducer.NumOfImagesPerSegment
  - from: SegmentDuration
    to: HistoricalScriptProducer.SegmentDuration
  - from: Style
    to: HistoricalScriptProducer.Style
  - from: Audience
    to: HistoricalScriptProducer.Audience
  - from: Language
    to: HistoricalScriptProducer.Language

  # --- Image generation ---
  - from: HistoricalScriptProducer.VideoScript.Segments[segment].ImagePrompts[image]
    to: ImageProducer[segment][image].Prompt
  - from: Size
    to: ImageProducer[segment][image].Resolution
  - from: AspectRatio
    to: ImageProducer[segment][image].AspectRatio
  - from: ImageProducer[segment][image].GeneratedImage
    to: SegmentImage[segment][image]
  - from: ImageProducer[segment][image].GeneratedImage
    to: TimelineComposer.ImageSegments
    groupBy: segment
    orderBy: image

  # --- Audio narration ---
  - from: HistoricalScriptProducer.VideoScript.Segments[segment].NarrationScript
    to: AudioProducer[segment].Text
  - from: VoiceId
    to: AudioProducer[segment].VoiceId
  - from: Emotion
    to: AudioProducer[segment].Emotion
  - from: AudioProducer[segment].GeneratedAudio
    to: SegmentAudio[segment]
  - from: AudioProducer[segment].GeneratedAudio
    to: TimelineComposer.AudioSegments

  # --- Text overlay (conditional) ---
  - from: HistoricalScriptProducer.VideoScript.Segments[segment].TextOverlay
    to: TimelineComposer.TextSegments
    if: hasTextOverlay

  # --- Background music ---
  - from: HistoricalScriptProducer.VideoScript.MusicPrompt
    to: MusicProducer.Prompt
  - from: Duration
    to: MusicProducer.Duration
  - from: MusicProducer.GeneratedMusic
    to: Music

  # --- Timeline composition ---
  - from: MusicProducer.GeneratedMusic
    to: TimelineComposer.Music
  - from: Duration
    to: TimelineComposer.Duration
  - from: TimelineComposer.Timeline
    to: Timeline

  # --- Transcription (wire audio to transcription track) ---
  - from: AudioProducer[segment].GeneratedAudio
    to: TimelineComposer.TranscriptionAudio

  # --- Video export with karaoke subtitles ---
  - from: TimelineComposer.Timeline
    to: TranscriptionProducer.Timeline
  - from: Language
    to: TranscriptionProducer.LanguageCode
  - from: TimelineComposer.Timeline
    to: VideoExporter.Timeline
  - from: AspectRatio
    to: VideoExporter.AspectRatio
  - from: TranscriptionProducer.Transcription
    to: VideoExporter.Transcription
  - from: VideoExporter.FinalVideo
    to: FinalVideo
