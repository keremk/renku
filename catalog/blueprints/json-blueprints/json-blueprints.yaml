meta:
  name: JSON Blueprint Test
  description: Test blueprint using JSON virtual artifacts to generate images.
  id: JsonBlueprint
  version: 0.1.0
  author: Renku
  license: MIT

inputs:
  - name: InquiryPrompt
    description: The topic describing the desired documentary.
    type: string
    required: true
  - name: NumOfImagesPerSegment
    description: Number of images per segment.
    type: int
    required: true
  - name: Style
    description: Image style description.
    type: string
    required: true
  - name: AspectRatio
    description: Image aspect ratio.
    type: string
    required: false
  - name: Size
    description: Image resolution (1K, 2K, 4K).
    type: string
    required: false

artifacts:
  - name: SegmentImage
    description: Generated images for each segment.
    type: multiDimArray
    itemType: image

loops:
  - name: segment
    countInput: NumOfSegments
  - name: image
    parent: segment
    countInput: NumOfImagesPerSegment

producers:
  - name: DocProducer
    producer: prompt/documentary
  - name: ImageProducer
    producer: asset/text-to-image
    loop: segment.image
  - name: TimelineComposer
    producer: composition/timeline-composer

connections:
  # Wire inputs to DocProducer
  - from: InquiryPrompt
    to: DocProducer.InquiryPrompt
  - from: Duration
    to: DocProducer.Duration
  - from: NumOfSegments
    to: DocProducer.NumOfSegments
  - from: NumOfImagesPerSegment
    to: DocProducer.NumOfImagesPerSegment
  - from: Style
    to: DocProducer.Style

  # Wire JSON virtual artifacts to ImageProducer
  - from: DocProducer.VideoScript.Segments[segment].ImagePrompts[image]
    to: ImageProducer[segment][image].Prompt
  - from: AspectRatio
    to: ImageProducer[segment][image].AspectRatio
  - from: Size
    to: ImageProducer[segment][image].Resolution

  # Wire ImageProducer outputs to TimelineComposer
  - from: ImageProducer[segment][image].GeneratedImage
    to: TimelineComposer.ImageSegments

  # Wire outputs to blueprint artifacts
  - from: ImageProducer[segment][image].GeneratedImage
    to: SegmentImage[segment][image]

  - from: Duration
    to: TimelineComposer.Duration
  - from: TimelineComposer.Timeline
    to: Timeline

collectors:
  - name: TimelineImages
    from: ImageProducer[segment][image].GeneratedImage
    into: TimelineComposer.ImageSegments
    groupBy: segment
    orderBy: image
