meta:
  name: Text-to-Image Generator
  description: Generate images from text prompts using various AI models.
  id: TextToImageProducer
  version: 0.1.0
  author: Renku
  license: MIT

inputs:
  - name: Prompt
    description: Text description of the image to generate.
    type: string

  # Sizing
  - name: AspectRatio
    description: "Aspect ratio (16:9, 9:16, 1:1, 4:3, 3:4, 3:2, 2:3, 21:9, 4:5, 5:4)."
    type: string
  - name: Resolution
    description: "Resolution preset (1K, 2K, 4K)."
    type: string
  - name: Width
    description: Custom width in pixels.
    type: integer
  - name: Height
    description: Custom height in pixels.
    type: integer

  # Generation control
  - name: NumImages
    description: Number of images to generate (1-6).
    type: integer
  - name: Seed
    description: Random seed for reproducibility.
    type: integer
  - name: GuidanceScale
    description: Prompt adherence strength (1-20).
    type: number
  - name: NegativePrompt
    description: What to avoid in the image.
    type: string
  - name: EnhancePrompt
    description: Enable LLM prompt enhancement.
    type: boolean

  # Output
  - name: OutputFormat
    description: "Image format (jpeg, png, webp)."
    type: string

  # Safety
  - name: EnableSafetyChecker
    description: Enable content moderation.
    type: boolean

  # Model-specific
  - name: Quality
    description: "Image quality level (low, medium, high)."
    type: string
  - name: Background
    description: "Background mode (auto, transparent, opaque)."
    type: string

artifacts:
  - name: GeneratedImage
    description: The generated image(s).
    type: image

mappings:
  fal-ai:
    # Pattern 4: image_size presets
    bytedance/seedream/v4.5/text-to-image:
      Prompt: prompt
      NumImages: num_images
      Seed: seed
      EnableSafetyChecker: enable_safety_checker
      # AspectRatio + Resolution combine into image_size
      ImageSize:
        combine:
          inputs: [AspectRatio, Resolution]
          table:
            # Resolution only (aspect determined by resolution)
            "+2K": auto_2K
            "+4K": auto_4K
            # AspectRatio only (default resolution)
            "16:9+": landscape_16_9
            "9:16+": portrait_16_9
            "4:3+": landscape_4_3
            "3:4+": portrait_4_3
            "1:1+": square_hd
            # Both specified - prefer resolution auto modes
            "16:9+2K": auto_2K
            "16:9+4K": auto_4K
            "1:1+2K": auto_2K
            "1:1+4K": auto_4K

    bytedance/seedream/v4/text-to-image:
      Prompt: prompt
      NumImages: num_images
      Seed: seed
      EnableSafetyChecker: enable_safety_checker
      EnhancePrompt:
        field: enhance_prompt_mode
        transform:
          true: standard
          false: fast
      AspectRatio:
        field: image_size
        transform:
          "16:9": landscape_16_9
          "9:16": portrait_16_9
          "4:3": landscape_4_3
          "3:4": portrait_4_3
          "1:1": square_hd
          "3:2": landscape_4_3
          "2:3": portrait_4_3

    # Pattern 1: aspect_ratio only
    flux-pro/kontext/text-to-image:
      Prompt: prompt
      NumImages: num_images
      Seed: seed
      GuidanceScale: guidance_scale
      EnhancePrompt: enhance_prompt
      OutputFormat: output_format
      AspectRatio: aspect_ratio
      # Resolution ignored - model doesn't support it

    # Pattern 5: Fixed dimension strings
    gpt-image-1.5:
      Prompt: prompt
      NumImages: num_images
      OutputFormat: output_format
      Quality: quality
      Background: background
      AspectRatio:
        field: image_size
        transform:
          "1:1": "1024x1024"
          "16:9": "1536x1024"
          "9:16": "1024x1536"
          # Other ratios not supported - error or default
      # Resolution ignored - only fixed sizes

    # Pattern 2: aspect_ratio + resolution
    nano-banana-pro:
      Prompt: prompt
      NumImages: num_images
      OutputFormat: output_format
      AspectRatio: aspect_ratio
      Resolution: resolution
      # Both pass through directly

    # Pattern 4: image_size presets
    qwen-image-2512:
      Prompt: prompt
      NumImages: num_images
      Seed: seed
      GuidanceScale: guidance_scale
      NegativePrompt: negative_prompt
      EnableSafetyChecker: enable_safety_checker
      OutputFormat: output_format
      AspectRatio:
        field: image_size
        transform:
          "16:9": landscape_16_9
          "9:16": portrait_16_9
          "4:3": landscape_4_3
          "3:4": portrait_4_3
          "1:1": square_hd
          "3:2": landscape_4_3
          "2:3": portrait_4_3
      # Resolution: use image_size object form
      ImageSize:
        conditional:
          when:
            input: Resolution
            notEmpty: true
          then:
            combine:
              inputs: [AspectRatio, Resolution]
              table:
                "16:9+1K": { width: 1920, height: 1080 }
                "16:9+2K": { width: 2560, height: 1440 }
                "1:1+1K": { width: 1024, height: 1024 }
                "1:1+2K": { width: 2048, height: 2048 }

    wan/v2.6/text-to-image:
      Prompt: prompt
      Seed: seed
      NegativePrompt: negative_prompt
      NumImages: max_images
      EnableSafetyChecker: enable_safety_checker
      AspectRatio:
        field: image_size
        transform:
          "16:9": landscape_16_9
          "9:16": portrait_16_9
          "4:3": landscape_4_3
          "3:4": portrait_4_3
          "1:1": square_hd

  replicate:
    # Bytedance Seedream 4
    bytedance/seedream-4:
      Prompt: prompt
      AspectRatio: aspect_ratio
      Resolution: size
      Width: width
      Height: height
      NumImages: max_images
      EnhancePrompt: enhance_prompt

    # Bytedance Seedream 4.5
    bytedance/seedream-4.5:
      Prompt: prompt
      AspectRatio: aspect_ratio
      Resolution: size
      Width: width
      Height: height
      NumImages: max_images
      EnhancePrompt: enhance_prompt

    # Google Nano Banana
    google/nano-banana:
      Prompt: prompt
      AspectRatio: aspect_ratio

    # Pattern 1: aspect_ratio only
    google/imagen-4:
      Prompt: prompt
      OutputFormat: output_format
      AspectRatio: aspect_ratio
      # Only supports: 1:1, 9:16, 16:9, 3:4, 4:3
      # Resolution ignored

    # Pattern 7: Width/Height only
    prunaai/z-image-turbo:
      Prompt: prompt
      Seed: seed
      GuidanceScale: guidance_scale
      OutputFormat: output_format
      Width: width
      Height: height
      # For users who specify AspectRatio + Resolution:
      ImageSize:
        conditional:
          when:
            input: Width
            empty: true
          then:
            combine:
              inputs: [AspectRatio, Resolution]
              table:
                "16:9+1K": { width: 1024, height: 576 }
                "9:16+1K": { width: 576, height: 1024 }
                "1:1+1K": { width: 1024, height: 1024 }
                "16:9+": { width: 1024, height: 576 }
                "1:1+": { width: 1024, height: 1024 }
