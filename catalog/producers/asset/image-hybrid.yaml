meta:
  name: Hybrid Image Generator
  description: Generate images from text, optionally using reference images for guidance.
  id: ImageHybridProducer
  version: 0.1.0
  author: Renku
  license: MIT

inputs:
  - name: Prompt
    description: Text description of the image to generate.
    type: string

  # Optional reference images
  - name: ReferenceImages
    description: Optional reference image(s) for style/content guidance.
    type: collection
    itemType: image

  # Sizing
  - name: AspectRatio
    description: "Aspect ratio (match_input_image, 16:9, 9:16, 1:1, etc.)."
    type: string
  - name: Resolution
    description: "Resolution preset (1K, 2K, 4K, custom)."
    type: string
  - name: Width
    description: Custom width in pixels.
    type: integer
  - name: Height
    description: Custom height in pixels.
    type: integer

  # Generation control (includes i2i-specific params)
  - name: Strength
    description: Reference image influence strength (0.0-1.0). Lower = more creative.
    type: number
  - name: NumImages
    description: Number of images to generate.
    type: integer
  - name: Seed
    description: Random seed for reproducibility.
    type: integer
  - name: GuidanceScale
    description: Prompt adherence strength.
    type: number
  - name: NegativePrompt
    description: What to avoid in the image.
    type: string
  - name: EnhancePrompt
    description: Enable LLM prompt enhancement.
    type: boolean

  # Output
  - name: OutputFormat
    description: "Image format (jpeg, png, webp, jpg)."
    type: string

  # Safety
  - name: EnableSafetyChecker
    description: Enable content moderation.
    type: boolean

artifacts:
  - name: GeneratedImage
    description: The generated image(s).
    type: image

mappings:
  # Hybrid models support text-to-image AND optional reference images
  replicate:
    # Pattern 3: size + aspect_ratio + optional width/height
    bytedance/seedream-4.5:
      Prompt: prompt
      ReferenceImages: image_input
      NumImages: max_images
      AspectRatio: aspect_ratio
      Resolution:
        field: size
        transform:
          "1K": "2K"  # 1K not supported, upgrade to 2K
          "2K": "2K"
          "4K": "4K"
          "custom": "custom"
      # Conditional: only include width/height when Resolution=custom
      Width:
        conditional:
          when:
            input: Resolution
            equals: custom
          then:
            field: width
      Height:
        conditional:
          when:
            input: Resolution
            equals: custom
          then:
            field: height

    bytedance/seedream-4:
      Prompt: prompt
      ReferenceImages: image_input
      NumImages: max_images
      EnhancePrompt: enhance_prompt
      AspectRatio: aspect_ratio
      Resolution:
        field: size
        transform:
          "1K": "1K"
          "2K": "2K"
          "4K": "4K"
          "custom": "custom"
      Width:
        conditional:
          when:
            input: Resolution
            equals: custom
          then:
            field: width
      Height:
        conditional:
          when:
            input: Resolution
            equals: custom
          then:
            field: height

    # Pattern 2: aspect_ratio + resolution
    google/nano-banana-pro:
      Prompt: prompt
      ReferenceImages: image_input
      OutputFormat: output_format
      AspectRatio: aspect_ratio
      Resolution: resolution

    google/nano-banana:
      Prompt: prompt
      ReferenceImages: image_input
      OutputFormat: output_format
      AspectRatio: aspect_ratio
      # No resolution support

    # Pattern 6: aspect_ratio + quality mode
    qwen/qwen-image:
      Prompt: prompt
      ReferenceImages:
        field: image
        firstOf: true  # Takes first element from array
      Strength: strength
      GuidanceScale: guidance
      Seed: seed
      NegativePrompt: negative_prompt
      EnhancePrompt: enhance_prompt
      OutputFormat: output_format
      EnableSafetyChecker:
        field: disable_safety_checker
        invert: true
      AspectRatio: aspect_ratio
      # Resolution maps to quality mode
      Resolution:
        field: image_size
        transform:
          "1K": optimize_for_speed
          "2K": optimize_for_quality
          "4K": optimize_for_quality
