meta:
  name: Hybrid Image Generator
  description: Generate images from text, optionally using reference images for guidance.
  id: ImageHybridProducer
  kind: producer
  version: 0.1.0
  author: Renku
  license: MIT

inputs:
  - name: Prompt
    description: Text description of the image to generate.
    type: string

  # Optional reference images
  - name: ReferenceImages
    description: Optional reference image(s) for style/content guidance.
    type: collection
    itemType: image

  # Sizing
  - name: AspectRatio
    description: "Aspect ratio (match_input_image, 16:9, 9:16, 1:1, etc.)."
    type: string
  - name: Resolution
    description: "Resolution preset (1K, 2K, 4K, custom)."
    type: string
  - name: Width
    description: Custom width in pixels.
    type: integer
  - name: Height
    description: Custom height in pixels.
    type: integer

artifacts:
  - name: GeneratedImage
    description: The generated image(s).
    type: image

mappings:
  # Hybrid models support text-to-image AND optional reference images
  replicate:
    # Pattern 3: size + aspect_ratio + optional width/height
    bytedance/seedream-4.5:
      Prompt: prompt
      ReferenceImages: image_input
      AspectRatio: aspect_ratio
      Resolution:
        field: size
        transform:
          "1K": "2K"  # 1K not supported, upgrade to 2K
          "2K": "2K"
          "4K": "4K"
          "custom": "custom"
      # Conditional: only include width/height when Resolution=custom
      Width:
        conditional:
          when:
            input: Resolution
            equals: custom
          then:
            field: width
      Height:
        conditional:
          when:
            input: Resolution
            equals: custom
          then:
            field: height

    bytedance/seedream-4:
      Prompt: prompt
      ReferenceImages: image_input
      AspectRatio: aspect_ratio
      Resolution:
        field: size
        transform:
          "1K": "1K"
          "2K": "2K"
          "4K": "4K"
          "custom": "custom"
      Width:
        conditional:
          when:
            input: Resolution
            equals: custom
          then:
            field: width
      Height:
        conditional:
          when:
            input: Resolution
            equals: custom
          then:
            field: height

    # Pattern 2: aspect_ratio + resolution
    google/nano-banana-pro:
      Prompt: prompt
      ReferenceImages: image_input
      AspectRatio: aspect_ratio
      Resolution: resolution

    google/nano-banana:
      Prompt: prompt
      ReferenceImages: image_input
      AspectRatio: aspect_ratio
      # No resolution support

    # Pattern 6: aspect_ratio + quality mode
    qwen/qwen-image:
      Prompt: prompt
      ReferenceImages:
        field: image
        firstOf: true  # Takes first element from array
      AspectRatio: aspect_ratio
      # Resolution maps to quality mode
      Resolution:
        field: image_size
        transform:
          "1K": optimize_for_speed
          "2K": optimize_for_quality
          "4K": optimize_for_quality
